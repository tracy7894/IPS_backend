# --- IG è¨­å®š ---
ig:
  profiles:

    patient: "http://hl7.org/fhir/uv/ips/StructureDefinition/Patient-uv-ips"
    #patient: "http://hl7.org/fhir/uv/ips/StructureDefinition/Patient-ips"
    #allergyintolerance: "http://hl7.org/fhir/StructureDefinition/AllergyIntolerance"
    allergyintolerance: "http://hl7.org/fhir/uv/ips/StructureDefinition/AllergyIntolerance-uv-ips"
# --- ä¾†æºè·¯ç”± ---
type_router:
  # Patient ä¾†æºç¾åœ¨æŒ‡å‘é™£åˆ—ï¼Œå·¥å…·å¯ä»¥æ­£å¸¸è™•ç†äº†
  - source: "$.ç—…æ‚£æ¸…å–®[*]"
    make: "Patient"
    fields:
      identifier:
        - system: "urn:oid:1.2.886.4.6.1.1.999"
          value: "$.èº«åˆ†è­‰è™Ÿ"
      name:
        - use: "official"   # TW Core IG è¦å®šå¿…å¡«
          text: "$.å§“å"
          family: "$.å§“"
          given: "$.å"
      gender: "$.æ€§åˆ¥"
      birthDate: "$.å‡ºç”Ÿæ—¥æœŸ"

      # ğŸ“ è¯çµ¡è³‡è¨Š (telecom)
      telecom:
        - system: "$.è¯çµ¡æ–¹å¼.ç³»çµ±"
          value: "$.è¯çµ¡æ–¹å¼.å€¼"
          use: "$.è¯çµ¡æ–¹å¼.ç”¨é€”"
          rank: "$.è¯çµ¡æ–¹å¼.æ’åº"

      # ğŸ  åœ°å€
      address:
        - use: "home"
          type: "both"
          country: "$.åœ°å€.åœ‹å®¶"
          line: "$.åœ°å€.è©³ç´°"
          city: "$.åœ°å€.ç¸£å¸‚"
          district: "$.åœ°å€.é„‰é®å€"   # TW Core å¿…å¡«
          text: "å¾…å¾Œç«¯è™•ç†"
          postalCode: "$.åœ°å€.éƒµéå€è™Ÿ"

      # âš™ï¸ å…¶ä»–ç‹€æ…‹
      active: "$.æ˜¯å¦æœ‰æ•ˆ"
      maritalStatus: "$.å©šå§»ç‹€æ…‹"
      deceasedBoolean: "$.æ˜¯å¦æ­»äº¡"
      deceasedDateTime: "$.æ­»äº¡æ—¥æœŸ"

      # ğŸš¨ ç·Šæ€¥è¯çµ¡äºº
      contact:
        - relationship:
          - coding:
            - system: "http://terminology.hl7.org/CodeSystem/v2-0131"
              code: "$.ç·Šæ€¥è¯çµ¡äºº.é—œä¿‚"        
          name:
            use: "official"
            text: "$.ç·Šæ€¥è¯çµ¡äºº.å§“å"
            family: "$.ç·Šæ€¥è¯çµ¡äºº.å§“"
            given: "$.ç·Šæ€¥è¯çµ¡äºº.å"
          telecom:
            - system: "$.ç·Šæ€¥è¯çµ¡äºº.è¯çµ¡æ–¹å¼.ç³»çµ±"
              value: "$.ç·Šæ€¥è¯çµ¡äºº.è¯çµ¡æ–¹å¼.å€¼"
              use: "$.ç·Šæ€¥è¯çµ¡äºº.è¯çµ¡æ–¹å¼.ç”¨é€”"
          address:
            use: "home"
            type: "both"
            country: "$.ç·Šæ€¥è¯çµ¡äºº.åœ°å€.åœ‹å®¶"
            line: "$.ç·Šæ€¥è¯çµ¡äºº.åœ°å€.è©³ç´°"
            city: "$.ç·Šæ€¥è¯çµ¡äºº.åœ°å€.ç¸£å¸‚"
            district: "$.ç·Šæ€¥è¯çµ¡äºº.åœ°å€.é„‰é®å€"   # TW Core å¿…å¡«
            postalCode: "$.ç·Šæ€¥è¯çµ¡äºº.åœ°å€.éƒµéå€è™Ÿ"
          gender: "$.ç·Šæ€¥è¯çµ¡äºº.æ€§åˆ¥"
          organization: "$.ç·Šæ€¥è¯çµ¡äºº.æ‰€å±¬å–®ä½"
 # ğŸ—£ï¸ èªè¨€èˆ‡æºé€šåå¥½
      communication:
        - language:
            coding:
              - system: "urn:ietf:bcp:47"
                code: "$.èªè¨€.ä»£ç¢¼"
                display: "$.èªè¨€.åç¨±"

      # ğŸ¥ ç®¡ç†æ©Ÿæ§‹. ç¢ºèª
      managingOrganization:
        reference: "Organization/$.æ‰€å±¬æ©Ÿæ§‹.id"
        display: "$.æ‰€å±¬æ©Ÿæ§‹.åç¨±"

      # ğŸ–¼ï¸ ç…§ç‰‡
      photo:
        - contentType: "$.ç…§ç‰‡.æ ¼å¼"
          url: "$.ç…§ç‰‡.url"
          title: "$.ç…§ç‰‡.èªªæ˜"
          creation: "$.ç…§ç‰‡.å»ºç«‹æ—¥æœŸ"

  # AllergyIntolerance ä¾†æºä¹ŸæŒ‡å‘é™£åˆ—
  - source: "$.ç—…æ‚£æ¸…å–®[*].éæ•æ¸…å–®[*]"
    make: "AllergyIntolerance"
    fields:
      clinicalStatus:
        coding:
          - system: "http://terminology.hl7.org/CodeSystem/allergyintolerance-clinical"
            code: "$.è‡¨åºŠç‹€æ…‹"
        text: "$.è‡¨åºŠç‹€æ…‹"
      type: "$.é¡å‹"
      code:
        coding:
          - system: "http://snomed.info/sct"
            code: "$.éæ•åŸ.ä»£ç¢¼"
            display: "$.éæ•åŸ.åç¨±"
      # ç›´æ¥å¾ JSON ä¸­é å…ˆæº–å‚™å¥½çš„æ¬„ä½å–å€¼
      patient:
        reference: "$.é—œè¯ç—…æ‚£.reference"
        display: "$.é—œè¯ç—…æ‚£.display"
      onsetDateTime: "$.ç™¼ç”Ÿæ™‚é–“"
      reaction:
        - manifestation:
            - coding:
                - system: "http://snomed.info/sct"
                  code: "$.éæ•åæ‡‰.ç—‡ç‹€.ä»£ç¢¼"
                  display: "$.éæ•åæ‡‰.ç—‡ç‹€.åç¨±"
              text: "$.éæ•åæ‡‰.ç—‡ç‹€.åç¨±"
          severity: "$.éæ•åæ‡‰.åš´é‡ç¨‹åº¦"

# --- è¼¸å‡ºåˆ†çµ„ ---
output_groups:
  - name: "IPS"
    filename: "IPS.flash"
    resources: ["Patient", "AllergyIntolerance"]