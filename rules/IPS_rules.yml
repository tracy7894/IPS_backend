# --- IG è¨­å®š ---
ig:
  profiles:
   # composition: "http://hl7.org/fhir/uv/ips/StructureDefinition/Composition-uv-ips"
    patient: "http://hl7.org/fhir/uv/ips/StructureDefinition/Patient-uv-ips"
    allergyintolerance: "http://hl7.org/fhir/uv/ips/StructureDefinition/AllergyIntolerance-uv-ips"
    condition: "http://hl7.org/fhir/uv/ips/StructureDefinition/Condition-uv-ips"
    immunization: "http://hl7.org/fhir/uv/ips/StructureDefinition/Immunization-uv-ips"
    observation: "http://hl7.org/fhir/StructureDefinition/vitalsigns"
    #http://hl7.org/fhir/uv/ips/StructureDefinition/Composition-uv-ips
bundle:
  type: "transaction "  # collection | transaction | document | message
  identifier:
    system: "urn:uuid:0f9ea8c1-0a96-4f4f-85f0-b109ee8c7011"
    value: "auto"  # è‡ªå‹•ç”Ÿæˆ UUID
  meta:
    profile:
      - "http://hl7.org/fhir/uv/ips/StructureDefinition/Bundle-uv-ips"
# --- ä¾†æºè·¯ç”± ---
type_router:
 # - source: "$.ç—…æ‚£æ¸…å–®[*]"
    #make: "Composition"
    #fields:
      # Composition è³‡æºæœ¬èº«çš„ ID
     # id: "$.æ–‡ä»¶è³‡è¨Š.id"
      
      # æ–‡ä»¶ç‹€æ…‹ (IPS è¦æ±‚ final)
     # status: "final"

      # æ–‡ä»¶é¡å‹ (IPS å›ºå®šä½¿ç”¨ LOINC code '60591-5')
      #type:
      #  coding:
      #    - system: "http://loinc.org"
      #      code: "60591-5"
      #      display: "Patient summary document"
      
      # æ–‡ä»¶ä¸»é«” (æ˜¯é—œæ–¼å“ªä½ç—…æ‚£çš„)
    #  subject:
    #    reference: "$.é—œè¯ç—…æ‚£.reference"
    #    display: "$.é—œè¯ç—…æ‚£.åç¨±"
      
      # æ–‡ä»¶å»ºç«‹æ—¥æœŸ
    #  date: "$.æ–‡ä»¶è³‡è¨Š.æ–‡ä»¶æ—¥æœŸ"
      
      # æ–‡ä»¶ä½œè€… (é€šå¸¸æ˜¯é†«å¸«æˆ–æ©Ÿæ§‹)
    #  author:
    #    - reference: "$.é†«å¸«.reference"
    #      display: "$.é†«å¸«.åç¨±"
          
      # æ–‡ä»¶æ¨™é¡Œ
     # title: "International Patient Summary"
      
      # --- Section (ç« ç¯€) çš„å°æ‡‰ ---
      # é€™æ˜¯ Composition çš„æ ¸å¿ƒï¼Œç”¨ä¾†çµ„ç¹”æ–‡ä»¶å…§å®¹
    #section: "$.compositionSection"


  - source: "$.ç—…æ‚£æ¸…å–®[*]"
    make: "Patient"
    fields:
      id: "$.id"
      identifier:
        - system: "urn:oid:1.2.886.4.6.1.1.999"
          value: "$.èº«åˆ†è­‰è™Ÿ"
      name:
        - use: "official"   # TW Core IG è¦å®šå¿…å¡«
          text: "$.å§“å"
          family: "$.å§“"
          given: "$.å"
      gender: "$.æ€§åˆ¥"
      birthDate: "$.å‡ºç”Ÿæ—¥æœŸ"

      # ğŸ“ è¯çµ¡è³‡è¨Š (telecom)
      telecom:
        - system: "$.è¯çµ¡æ–¹å¼.ç³»çµ±"
          value: "$.è¯çµ¡æ–¹å¼.å€¼"
          use: "$.è¯çµ¡æ–¹å¼.ç”¨é€”"
          rank: "$.è¯çµ¡æ–¹å¼.æ’åº"

      # ğŸ  åœ°å€
      address:
        - use: "home"
          type: "both"
          country: "$.åœ°å€.åœ‹å®¶"
          line: "$.åœ°å€.è©³ç´°"
          city: "$.åœ°å€.ç¸£å¸‚"
          district: "$.åœ°å€.é„‰é®å€"   # TW Core å¿…å¡«
          text: "å¾…å¾Œç«¯è™•ç†"
          postalCode: "$.åœ°å€.éƒµéå€è™Ÿ"

      # âš™ï¸ å…¶ä»–ç‹€æ…‹
      active: "$.æ˜¯å¦æœ‰æ•ˆ"
     # maritalStatus: "$.å©šå§»ç‹€æ…‹"
      #deceasedBoolean: "$.æ˜¯å¦æ­»äº¡"
      #deceasedDateTime: "$.æ­»äº¡æ—¥æœŸ"

      # ğŸš¨ ç·Šæ€¥è¯çµ¡äºº å¯åˆª
      contact:
        - relationship:
            - coding:
                - system: "http://terminology.hl7.org/CodeSystem/v2-0131"
                  code: "$.ç·Šæ€¥è¯çµ¡äºº.é—œä¿‚"
                  display: "Next of Kin" 
                 
          name:
            use: "official"
            text: "é»ƒå¤§å§"
            family: "é»ƒ"
            given: "å¤§å§"
          telecom:
            - system: "phone"
              value: "0987654321"
              use: "home"
          address:
            use: "home"
            type: "both"
            country: "$.ç·Šæ€¥è¯çµ¡äºº.åœ°å€.åœ‹å®¶"
            line:
              - "$.ç·Šæ€¥è¯çµ¡äºº.åœ°å€.è©³ç´°"
            city: "$.ç·Šæ€¥è¯çµ¡äºº.åœ°å€.ç¸£å¸‚"
            district: "$.ç·Šæ€¥è¯çµ¡äºº.åœ°å€.é„‰é®å€"
            postalCode: "$.ç·Šæ€¥è¯çµ¡äºº.åœ°å€.éƒµéå€è™Ÿ"
          gender: "$.ç·Šæ€¥è¯çµ¡äºº.æ€§åˆ¥"
          organization:
            display: "$.ç·Šæ€¥è¯çµ¡äºº.æ‰€å±¬å–®ä½"

 # ğŸ—£ï¸ èªè¨€èˆ‡æºé€šåå¥½ å¯åˆª
      # communication:
      #   - language:
      #       coding:
      #         - system: "urn:ietf:bcp:47"
      #           code: "$.èªè¨€.ä»£ç¢¼"
      #           display: "$.èªè¨€.åç¨±"

      # ğŸ¥ ç®¡ç†æ©Ÿæ§‹. ç¢ºèª
      managingOrganization:
        reference: "$.æ‰€å±¬æ©Ÿæ§‹.reference"
        display: "$.æ‰€å±¬æ©Ÿæ§‹.åç¨±"
      generalPractitioner:
        - reference: "$.é†«å¸«.reference"
          display: "$.é†«å¸«.åç¨±"

      # ğŸ–¼ï¸ ç…§ç‰‡ å¯åˆª
      # photo:
      #   - contentType: "$.ç…§ç‰‡.æ ¼å¼"
      #     url: "$.ç…§ç‰‡.url"
      #     title: "$.ç…§ç‰‡.èªªæ˜"
      #     creation: "$.ç…§ç‰‡.å»ºç«‹æ—¥æœŸ"
        # generalPractitioner è¿½åŠ 
  # AllergyIntolerance ä¾†æºä¹ŸæŒ‡å‘é™£åˆ—
  - source: "$.ç—…æ‚£æ¸…å–®[*].éæ•æ¸…å–®[*]"
    make: "AllergyIntolerance"
    fields:
      id: "$.id"
      clinicalStatus:
        coding:
          - system: "http://terminology.hl7.org/CodeSystem/allergyintolerance-clinical"
            code: "$.è‡¨åºŠç‹€æ…‹.ä»£ç¢¼"
            display: "$.è‡¨åºŠç‹€æ…‹.åç¨±"
        text: "$.è‡¨åºŠç‹€æ…‹.ä¸­æ–‡åç¨±"
      type: "$.é¡å‹"
      code:
        coding:
          - system: "http://snomed.info/sct"
            code: "$.éæ•åŸ.ä»£ç¢¼"
            display: "$.éæ•åŸ.åç¨±"
        text: "$.éæ•åŸ.ä¸­æ–‡åç¨±"
      # ç›´æ¥å¾ JSON ä¸­é å…ˆæº–å‚™å¥½çš„æ¬„ä½å–å€¼
      patient:
        reference: "$.é—œè¯ç—…æ‚£.reference"
        display: "$.é—œè¯ç—…æ‚£.åç¨±"
      onsetDateTime: "$.ç™¼ç”Ÿæ™‚é–“"
      reaction:
        - manifestation:
            - coding:
                - system: "http://snomed.info/sct"
                  code: "$.éæ•åæ‡‰.ç—‡ç‹€.ä»£ç¢¼"
                  display: "$.éæ•åæ‡‰.ç—‡ç‹€.åç¨±"
              text: "$.éæ•åæ‡‰.ç—‡ç‹€.ä¸­æ–‡åç¨±"
          severity: "$.éæ•åæ‡‰.åš´é‡ç¨‹åº¦"


  - source: "$.ç—…æ‚£æ¸…å–®[*].ç—…æ³æ¸…å–®[*]"
    make: "Condition"
    fields:
      # æ‚£è€…
      id: "$.id"
      subject:
        reference: "$.é—œè¯ç—…æ‚£.reference"
        display: "$.é—œè¯ç—…æ‚£.åç¨±"
      clinicalStatus:
        coding:
          - system: "http://terminology.hl7.org/CodeSystem/condition-clinical"
            code: "$.è‡¨åºŠç‹€æ…‹.ä»£ç¢¼"
            display: "$.è‡¨åºŠç‹€æ…‹.åç¨±"
        text: "$.è‡¨åºŠç‹€æ…‹.ä¸­æ–‡åç¨±"
      # ç—…æ³/å•é¡Œ/è¨ºæ–·è­˜åˆ¥ï¼ˆå¿…å¡«ï¼‰
      code:
        coding:
          - system: "http://snomed.info/sct"  # æˆ–å…¶ä»–ä½ è³‡æ–™å°æ‡‰çš„ç³»çµ±
            code: "$.ä»£ç¢¼"
            display: "$.åç¨±"
        text: "$.ä¸­æ–‡åç¨±"
      # è‡¨åºŠç‹€æ…‹ï¼ˆéå¿…å¡«ï¼‰

      # é¡åˆ¥ï¼ˆå¿…å¡«ï¼‰
      category:
        - coding:
            - system: "http://terminology.hl7.org/CodeSystem/condition-category"
              code: "$.é¡åˆ¥"
              display: "$.é¡åˆ¥åç¨±"
          text: "$.ä¸­æ–‡é¡åˆ¥åç¨±"
      # åš´é‡ç¨‹åº¦ï¼ˆéå¿…å¡«ï¼‰
      severity:
        coding:
          - system: "http://snomed.info/sct"
            code: "$.åš´é‡ç¨‹åº¦ä»£ç¢¼"
            display: "$.åš´é‡ç¨‹åº¦åç¨±"
        text: "$.ä¸­æ–‡åš´é‡ç¨‹åº¦åç¨±"
      # ç™¼ç—…æ™‚é–“ï¼ˆéå¿…å¡«ï¼‰
      onsetDateTime: "$.ç™¼ç—…æ™‚é–“"
  # ... (Condition è¦å‰‡çš„çµå°¾)

  # ğŸ’‰ é é˜²æ¥ç¨®è³‡æ–™. categoryæœƒè‡ªå‹•åŠ  
 
  # ğŸ’‰ é é˜²æ¥ç¨®è³‡æ–™ åŠ‘æ¬¡è¦è£œ
  - source: "$.ç—…æ‚£æ¸…å–®[*].é é˜²æ¥ç¨®æ¸…å–®[*]"
    make: "Immunization"
    fields:
      # æ¥ç¨®ç‹€æ…‹ (å¿…å¡«)ã€‚
      status: "$.æ¥ç¨®ç‹€æ…‹"
      id: "$.id"
      # ç–«è‹—ä»£ç¢¼ (å¿…å¡«)
      vaccineCode:
        coding:
          - system: "$.ç–«è‹—ä»£ç¢¼.ç³»çµ±"
            code: "$.ç–«è‹—ä»£ç¢¼.ä»£ç¢¼"
            display: "$.ç–«è‹—ä»£ç¢¼.è‹±æ–‡åç¨±"
        text: "$.ç–«è‹—ä»£ç¢¼.ä¸­æ–‡åç¨±"
      dose: "$.åŠ‘æ¬¡"
      # ç—…äºº (å¿…å¡«)
      patient:
        reference: "$.é—œè¯ç—…æ‚£.reference"

      # æ¥ç¨®æ—¥æœŸ (å¿…å¡«)
      occurrenceDateTime: "$.æ¥ç¨®æ—¥æœŸ"
  - source: "$.ç—…æ‚£æ¸…å–®[*].ç”Ÿå‘½å¾µè±¡æ¸…å–®.ä¸€èˆ¬é …ç›®[*]"
    make: "Observation"
    fields:
      id: "$.id"
      status: "$.ç‹€æ…‹"
      code:
        coding:
          - system: "http://loinc.org"
            code: "$.æ¸¬é‡é …ç›®.ä»£ç¢¼"
            display: "$.æ¸¬é‡é …ç›®.åç¨±"
      subject:
        reference: "$.é—œè¯ç—…æ‚£.reference"
      effectiveDateTime: "$.æ¸¬é‡æ™‚é–“"
      valueQuantity:
        value: "$.æ¸¬é‡çµæœ.å€¼"
        unit: "$.æ¸¬é‡çµæœ.å–®ä½"
        code: "$.æ¸¬é‡çµæœ.å–®ä½ä»£ç¢¼"
        system: "http://unitsofmeasure.org"
 # - source: "$.ç—…æ‚£æ¸…å–®[*].ç”Ÿå‘½å¾µè±¡æ¸…å–®.è¡€å£“[*]"
  #  make: "Observation"
   # fields:
     # id: "$.id"
    #  status: "$.ç‹€æ…‹"

     # code:
      #  coding:
       #   - system: "http://loinc.org"
        #    code: "85354-9"
         #   display: "Blood pressure panel with all children optional"
      #subject:
       # reference: "$.é—œè¯ç—…æ‚£.reference"
        #display: "$.é—œè¯ç—…æ‚£.åç¨±"
      #effectiveDateTime: "$.æ¸¬é‡æ™‚é–“"
      
      #component:
       # - code:
       #     coding:
       #       - system: "http://loinc.org"
       #         code: "8480-6"
       #         display: "Systolic blood pressure"
       #   valueQuantity:
       #     system: "http://unitsofmeasure.org"
       #     value: "$.æ”¶ç¸®å£“"
       ##     unit: "mmHg"
       #     code: "mm[Hg]"

       # - code:
       #     coding:
       #       - system: "http://loinc.org"
       #         code: "8462-4"
       #         display: "Diastolic blood pressure"
       #   valueQuantity:
       #     system: "http://unitsofmeasure.org"
       #     value: "$.èˆ’å¼µå£“"
       #     unit: "mmHg"
       #     code: "mm[Hg]"


    




        
# --- è¼¸å‡ºåˆ†çµ„ ---
output_groups:
  - name: "IPS"
    filename: "IPS.flash"
    resources: ["Patient", "AllergyIntolerance", "Condition", "Immunization","Observation"]